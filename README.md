# my1942Game

## create # 2023.02.09
## FPGA：A7
## 基于M0软核实现经典FC游戏《1942》的模仿

## 2023.02.09
1. 完成通过CPU写精灵RAM
2. 硬件上完成碰撞检测
3. 硬件上完成tile的显示
4. 完成基本的SoC搭建与C语言测试

## 2023.02.13
1. 将画图模块tileDraw复制64份，生成bit流后，烧录后未成功，暂时搁置，不用这种显示方法

## 2023.02.14
1. 一共有64个精灵，将显示tiledraw复制8个，在扫描每一行之前对64个精灵ram进行扫描，需要在下一行进行显示的精灵会存到8个tiledraw中；也就是说游戏画面的每一行仅仅支持8个精灵。目前已经完成测试，并且很大程度上减少了资源的消耗。

## 2023.02.15
1. 采用C语言实现了碰撞检测：我方飞机、子弹与敌方飞机的碰撞检测（采用bitmask，掩码的碰撞检测）

## 2023.02.21
1. 实现了爆炸的效果（一共4帧动画）
2. 敌机简单的两段路径运动
3. 将FC游戏1942的256个精灵都存储在了精灵素材ROM里面，测试完成

## 2023.02.22
1. 优化了一下时序，在文件tileDraw.v中，使得显示比之前稳定了许多
2. 增加了buff单元（测试了使得子弹增加的buff，tile为"Pow"字样）

## 2023.02.24
1. 增加了我方飞机的闪避动画，期间不受攻击
2. 增加了敌方飞机发射子弹的功能，发射子弹方向基本上指向我方飞机
3. 当前的代码量似乎已经超过了ROM的空间（初步观察是绘图函数占用过多的代码，比较我方飞机无敌状态可考虑更换颜色来实现，虽然展示效果稍差）

## 2023.02.26
1. 测试了PS2手柄（目前采用的是IO软件模拟PS2协议），按键有效
2. 在Doc文件夹中添加了使用PS2手柄的pdf说明书

## 2023.03.03
1. 完成了通过名称表绘制背景的功能，目前只是从硬件上完成了数据通路，进行了测试（测试无误），但是可能后面资源不够用。rtl代码在C:\Users\hp\Desktop\my1942Game\RTL\src\game\PPU\backGround文件夹下面

## 2023.03.04
1. 重新整理了PPU模块，分为精灵绘制部分和背景绘制部分，CPU通过对精灵数据RAM和背景名称表nameTable（两个AHB外设）
2. 通过C语言对背景名称表进行了写操作，功能基本完成，但是32bit数据硬件大小端和习惯不符合

## 2023.03.07
1. 更新了Doc文件夹下的visio框图文件，绘制了一些框图
2. 将绘制精灵和绘制背景的调色板分开了，单独使用不同的调色板
3. 解决了# 2023.03.042. 提到的问题

## 2023.03.10
1. 创建了分支stateMachine_soft，记录将主程序改成状态机的过程
2. 创建了开机界面和结算界面，采用状态机实现（在分支stateMachine_soft上）
3. 解决了闪屏的问题，在topSpriteDraw.v的spriteVgaRgbOut的选择上，从链式结构换成了MUX结构

## 2023.03.12
1. 修改了README.md的写法
2. 修改了nameTable.v文件中nameTableRam的深度（为了移植到安路FPGA上不报错），在Doc有文件进行说明
3. 将分支stateMachine_soft合并到main上

## 2023.03.17
1. 将游戏的实际画面扩大了两倍（从RTL代码逻辑上实现）
2. 添加了一下中型敌机的路线动作，但是有时候会出现卡顿的现象，目前还不清楚原因
3. 将颜色改正了过来，和游戏一致了（之前的2bit颜色的高低整反了）
4. 完善了结算界面的“敌机击中数量”和命中率的数据

## 2023.03.19
1. 用RTL在硬件上进行中型敌机的状态机转换（碰撞检测都测试过了），不会再卡顿了，之后的大型敌机打算也采用这个硬件实现的方式

## 2023.03.25
1. 整理了一下一些小飞机的姿态组成（在main.c函数中，但是还没形成文档）
2. 在硬件上PPU作图单元，基本实现背景的滚动以及名称表的匹配，现在可以直接通过模拟器手动提取出地图数据来作为我们自己的地图（PPU功能还有待完善）
3. 尝试了一下制作关卡数据，后续的关卡数据可能会存放在Flash中

## 2023.03.30
1. 重新编写了关于游戏的C语言文件（原先是所有单位都在一个myGame.h文件中，给后续扩展造成了不便，故重新新建了MY_GAME文件夹，将不同单位分开）
2. 利用spi_flash的读写操作，将地图写入flash进行了尝试
3. 上述的修改提交到了新建的分支“branch_flash_save”上

## 2023.04.01
1. 将背景滚动控制模块scrollCtrl连接到了软核上，进行了相应控制和测试，基本没有问题（存在一个小BUG，到一定位置会跳一下）
2. 将分支branch_flash_save合并到主分支main上

## 2023.04.05
1. 制作了大型绿色敌机的显示和移动路线

## 2023.04.12
1. 软件可以对SPI_FLASH进行读写操作，硬件可以对SPI_FLASH进行读操作从而满足背景滚动的需求，两者共用同一个SPI_FLASH，采用MUX2-1进行选择，便于后续关卡的随时更改

## 2023.04.16
1. 解决了2023.04.01中提到的关于背景滚动的BUG
2. 解决了多个精灵重叠时显示不全的问题

## 2023.04.18
1. 添加了大型绿色飞机发射子弹的功能，数量多，效果还不错
2. 添加了大型绿色飞机的碰撞检测和中型直飞路线飞机的碰撞检测
3. 添加了一条异步时钟的约束，综合实现的时间从17min缩短至4min，节约时间